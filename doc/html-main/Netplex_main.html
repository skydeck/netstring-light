<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Netplex_workload.html">
<link rel="next" href="Netplex_config.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Uq_gtk" rel="Chapter" href="Uq_gtk.html">
<link title="Equeue" rel="Chapter" href="Equeue.html">
<link title="Unixqueue" rel="Chapter" href="Unixqueue.html">
<link title="Unixqueue_pollset" rel="Chapter" href="Unixqueue_pollset.html">
<link title="Unixqueue_select" rel="Chapter" href="Unixqueue_select.html">
<link title="Uq_resolver" rel="Chapter" href="Uq_resolver.html">
<link title="Uq_engines" rel="Chapter" href="Uq_engines.html">
<link title="Uq_socks5" rel="Chapter" href="Uq_socks5.html">
<link title="Uq_io" rel="Chapter" href="Uq_io.html">
<link title="Uq_lwt" rel="Chapter" href="Uq_lwt.html">
<link title="Uq_libevent" rel="Chapter" href="Uq_libevent.html">
<link title="Uq_mt" rel="Chapter" href="Uq_mt.html">
<link title="Equeue_intro" rel="Chapter" href="Equeue_intro.html">
<link title="Equeue_howto" rel="Chapter" href="Equeue_howto.html">
<link title="Uq_ssl" rel="Chapter" href="Uq_ssl.html">
<link title="Https_client" rel="Chapter" href="Https_client.html">
<link title="Uq_tcl" rel="Chapter" href="Uq_tcl.html">
<link title="Netcamlbox" rel="Chapter" href="Netcamlbox.html">
<link title="Netcgi_apache" rel="Chapter" href="Netcgi_apache.html">
<link title="Netcgi_modtpl" rel="Chapter" href="Netcgi_modtpl.html">
<link title="Netcgi_common" rel="Chapter" href="Netcgi_common.html">
<link title="Netcgi" rel="Chapter" href="Netcgi.html">
<link title="Netcgi_ajp" rel="Chapter" href="Netcgi_ajp.html">
<link title="Netcgi_scgi" rel="Chapter" href="Netcgi_scgi.html">
<link title="Netcgi_cgi" rel="Chapter" href="Netcgi_cgi.html">
<link title="Netcgi_fcgi" rel="Chapter" href="Netcgi_fcgi.html">
<link title="Netcgi_dbi" rel="Chapter" href="Netcgi_dbi.html">
<link title="Netcgi1_compat" rel="Chapter" href="Netcgi1_compat.html">
<link title="Netcgi_test" rel="Chapter" href="Netcgi_test.html">
<link title="Netcgi_porting" rel="Chapter" href="Netcgi_porting.html">
<link title="Netcgi_plex" rel="Chapter" href="Netcgi_plex.html">
<link title="Http_client_conncache" rel="Chapter" href="Http_client_conncache.html">
<link title="Http_client" rel="Chapter" href="Http_client.html">
<link title="Telnet_client" rel="Chapter" href="Telnet_client.html">
<link title="Ftp_data_endpoint" rel="Chapter" href="Ftp_data_endpoint.html">
<link title="Ftp_client" rel="Chapter" href="Ftp_client.html">
<link title="Http_fs" rel="Chapter" href="Http_fs.html">
<link title="Ftp_fs" rel="Chapter" href="Ftp_fs.html">
<link title="Netclient_tut" rel="Chapter" href="Netclient_tut.html">
<link title="Netgssapi" rel="Chapter" href="Netgssapi.html">
<link title="Nethttpd_types" rel="Chapter" href="Nethttpd_types.html">
<link title="Nethttpd_kernel" rel="Chapter" href="Nethttpd_kernel.html">
<link title="Nethttpd_reactor" rel="Chapter" href="Nethttpd_reactor.html">
<link title="Nethttpd_engine" rel="Chapter" href="Nethttpd_engine.html">
<link title="Nethttpd_services" rel="Chapter" href="Nethttpd_services.html">
<link title="Nethttpd_plex" rel="Chapter" href="Nethttpd_plex.html">
<link title="Nethttpd_util" rel="Chapter" href="Nethttpd_util.html">
<link title="Nethttpd_intro" rel="Chapter" href="Nethttpd_intro.html">
<link title="Netmech_scram" rel="Chapter" href="Netmech_scram.html">
<link title="Netmech_scram_gssapi" rel="Chapter" href="Netmech_scram_gssapi.html">
<link title="Netmcore" rel="Chapter" href="Netmcore.html">
<link title="Netmcore_camlbox" rel="Chapter" href="Netmcore_camlbox.html">
<link title="Netmcore_mempool" rel="Chapter" href="Netmcore_mempool.html">
<link title="Netmcore_heap" rel="Chapter" href="Netmcore_heap.html">
<link title="Netmcore_ref" rel="Chapter" href="Netmcore_ref.html">
<link title="Netmcore_array" rel="Chapter" href="Netmcore_array.html">
<link title="Netmcore_sem" rel="Chapter" href="Netmcore_sem.html">
<link title="Netmcore_mutex" rel="Chapter" href="Netmcore_mutex.html">
<link title="Netmcore_condition" rel="Chapter" href="Netmcore_condition.html">
<link title="Netmcore_queue" rel="Chapter" href="Netmcore_queue.html">
<link title="Netmcore_buffer" rel="Chapter" href="Netmcore_buffer.html">
<link title="Netmcore_matrix" rel="Chapter" href="Netmcore_matrix.html">
<link title="Netmcore_hashtbl" rel="Chapter" href="Netmcore_hashtbl.html">
<link title="Netmcore_process" rel="Chapter" href="Netmcore_process.html">
<link title="Netmcore_tut" rel="Chapter" href="Netmcore_tut.html">
<link title="Netplex_types" rel="Chapter" href="Netplex_types.html">
<link title="Netplex_mp" rel="Chapter" href="Netplex_mp.html">
<link title="Netplex_mt" rel="Chapter" href="Netplex_mt.html">
<link title="Netplex_log" rel="Chapter" href="Netplex_log.html">
<link title="Netplex_controller" rel="Chapter" href="Netplex_controller.html">
<link title="Netplex_container" rel="Chapter" href="Netplex_container.html">
<link title="Netplex_sockserv" rel="Chapter" href="Netplex_sockserv.html">
<link title="Netplex_workload" rel="Chapter" href="Netplex_workload.html">
<link title="Netplex_main" rel="Chapter" href="Netplex_main.html">
<link title="Netplex_config" rel="Chapter" href="Netplex_config.html">
<link title="Netplex_kit" rel="Chapter" href="Netplex_kit.html">
<link title="Rpc_netplex" rel="Chapter" href="Rpc_netplex.html">
<link title="Netplex_cenv" rel="Chapter" href="Netplex_cenv.html">
<link title="Netplex_semaphore" rel="Chapter" href="Netplex_semaphore.html">
<link title="Netplex_sharedvar" rel="Chapter" href="Netplex_sharedvar.html">
<link title="Netplex_mutex" rel="Chapter" href="Netplex_mutex.html">
<link title="Netplex_encap" rel="Chapter" href="Netplex_encap.html">
<link title="Netplex_intro" rel="Chapter" href="Netplex_intro.html">
<link title="Netplex_advanced" rel="Chapter" href="Netplex_advanced.html">
<link title="Netplex_admin" rel="Chapter" href="Netplex_admin.html">
<link title="Netshm" rel="Chapter" href="Netshm.html">
<link title="Netshm_data" rel="Chapter" href="Netshm_data.html">
<link title="Netshm_hashtbl" rel="Chapter" href="Netshm_hashtbl.html">
<link title="Netshm_array" rel="Chapter" href="Netshm_array.html">
<link title="Netshm_intro" rel="Chapter" href="Netshm_intro.html">
<link title="Netconversion" rel="Chapter" href="Netconversion.html">
<link title="Netchannels" rel="Chapter" href="Netchannels.html">
<link title="Netstream" rel="Chapter" href="Netstream.html">
<link title="Mimestring" rel="Chapter" href="Mimestring.html">
<link title="Netmime" rel="Chapter" href="Netmime.html">
<link title="Netsendmail" rel="Chapter" href="Netsendmail.html">
<link title="Neturl" rel="Chapter" href="Neturl.html">
<link title="Netaddress" rel="Chapter" href="Netaddress.html">
<link title="Netbuffer" rel="Chapter" href="Netbuffer.html">
<link title="Netdate" rel="Chapter" href="Netdate.html">
<link title="Netencoding" rel="Chapter" href="Netencoding.html">
<link title="Netulex" rel="Chapter" href="Netulex.html">
<link title="Netaccel" rel="Chapter" href="Netaccel.html">
<link title="Netaccel_link" rel="Chapter" href="Netaccel_link.html">
<link title="Nethtml" rel="Chapter" href="Nethtml.html">
<link title="Netstring_str" rel="Chapter" href="Netstring_str.html">
<link title="Netmappings" rel="Chapter" href="Netmappings.html">
<link title="Netaux" rel="Chapter" href="Netaux.html">
<link title="Nethttp" rel="Chapter" href="Nethttp.html">
<link title="Netpagebuffer" rel="Chapter" href="Netpagebuffer.html">
<link title="Netfs" rel="Chapter" href="Netfs.html">
<link title="Netglob" rel="Chapter" href="Netglob.html">
<link title="Netauth" rel="Chapter" href="Netauth.html">
<link title="Netsockaddr" rel="Chapter" href="Netsockaddr.html">
<link title="Netnumber" rel="Chapter" href="Netnumber.html">
<link title="Rtypes" rel="Chapter" href="Rtypes.html">
<link title="Xdr_mstring" rel="Chapter" href="Xdr_mstring.html">
<link title="Xdr" rel="Chapter" href="Xdr.html">
<link title="Netcompression" rel="Chapter" href="Netcompression.html">
<link title="Netunichar" rel="Chapter" href="Netunichar.html">
<link title="Netchannels_tut" rel="Chapter" href="Netchannels_tut.html">
<link title="Netmime_tut" rel="Chapter" href="Netmime_tut.html">
<link title="Netsendmail_tut" rel="Chapter" href="Netsendmail_tut.html">
<link title="Netulex_tut" rel="Chapter" href="Netulex_tut.html">
<link title="Neturl_tut" rel="Chapter" href="Neturl_tut.html">
<link title="Netstring_pcre" rel="Chapter" href="Netstring_pcre.html">
<link title="Netsys" rel="Chapter" href="Netsys.html">
<link title="Netsys_posix" rel="Chapter" href="Netsys_posix.html">
<link title="Netsys_pollset" rel="Chapter" href="Netsys_pollset.html">
<link title="Netlog" rel="Chapter" href="Netlog.html">
<link title="Netexn" rel="Chapter" href="Netexn.html">
<link title="Netsys_win32" rel="Chapter" href="Netsys_win32.html">
<link title="Netsys_pollset_posix" rel="Chapter" href="Netsys_pollset_posix.html">
<link title="Netsys_pollset_win32" rel="Chapter" href="Netsys_pollset_win32.html">
<link title="Netsys_pollset_generic" rel="Chapter" href="Netsys_pollset_generic.html">
<link title="Netsys_signal" rel="Chapter" href="Netsys_signal.html">
<link title="Netsys_oothr" rel="Chapter" href="Netsys_oothr.html">
<link title="Netsys_xdr" rel="Chapter" href="Netsys_xdr.html">
<link title="Netsys_rng" rel="Chapter" href="Netsys_rng.html">
<link title="Netsys_types" rel="Chapter" href="Netsys_types.html">
<link title="Netsys_mem" rel="Chapter" href="Netsys_mem.html">
<link title="Netsys_tmp" rel="Chapter" href="Netsys_tmp.html">
<link title="Netsys_sem" rel="Chapter" href="Netsys_sem.html">
<link title="Netsys_pmanage" rel="Chapter" href="Netsys_pmanage.html">
<link title="Netgzip" rel="Chapter" href="Netgzip.html">
<link title="Netpop" rel="Chapter" href="Netpop.html">
<link title="Rpc_auth_dh" rel="Chapter" href="Rpc_auth_dh.html">
<link title="Rpc_key_service" rel="Chapter" href="Rpc_key_service.html">
<link title="Rpc_time" rel="Chapter" href="Rpc_time.html">
<link title="Rpc_auth_local" rel="Chapter" href="Rpc_auth_local.html">
<link title="Rpc" rel="Chapter" href="Rpc.html">
<link title="Rpc_program" rel="Chapter" href="Rpc_program.html">
<link title="Rpc_util" rel="Chapter" href="Rpc_util.html">
<link title="Rpc_portmapper_aux" rel="Chapter" href="Rpc_portmapper_aux.html">
<link title="Rpc_packer" rel="Chapter" href="Rpc_packer.html">
<link title="Rpc_transport" rel="Chapter" href="Rpc_transport.html">
<link title="Rpc_client" rel="Chapter" href="Rpc_client.html">
<link title="Rpc_simple_client" rel="Chapter" href="Rpc_simple_client.html">
<link title="Rpc_portmapper_clnt" rel="Chapter" href="Rpc_portmapper_clnt.html">
<link title="Rpc_portmapper" rel="Chapter" href="Rpc_portmapper.html">
<link title="Rpc_server" rel="Chapter" href="Rpc_server.html">
<link title="Rpc_auth_sys" rel="Chapter" href="Rpc_auth_sys.html">
<link title="Rpc_auth_gssapi" rel="Chapter" href="Rpc_auth_gssapi.html">
<link title="Rpc_proxy" rel="Chapter" href="Rpc_proxy.html">
<link title="Rpc_intro" rel="Chapter" href="Rpc_intro.html">
<link title="Rpc_mapping_ref" rel="Chapter" href="Rpc_mapping_ref.html">
<link title="Rpc_intro_gss" rel="Chapter" href="Rpc_intro_gss.html">
<link title="Rpc_ssl" rel="Chapter" href="Rpc_ssl.html">
<link title="Rpc_xti_client" rel="Chapter" href="Rpc_xti_client.html">
<link title="Shell_sys" rel="Chapter" href="Shell_sys.html">
<link title="Shell" rel="Chapter" href="Shell.html">
<link title="Shell_uq" rel="Chapter" href="Shell_uq.html">
<link title="Shell_fs" rel="Chapter" href="Shell_fs.html">
<link title="Shell_intro" rel="Chapter" href="Shell_intro.html">
<link title="Netsmtp" rel="Chapter" href="Netsmtp.html">
<link title="Intro" rel="Chapter" href="Intro.html">
<link title="Platform" rel="Chapter" href="Platform.html">
<link title="Foreword" rel="Chapter" href="Foreword.html">
<link title="Ipv6" rel="Chapter" href="Ipv6.html"><link title="Tutorial" rel="Section" href="#2_Tutorial">
<title>Ocamlnet 3 Reference Manual : Netplex_main</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Netplex_workload.html" title="Netplex_workload">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Netplex_config.html" title="Netplex_config">Next</a>
</div>
<h1>Module <a href="type_Netplex_main.html">Netplex_main</a></h1>
<pre><span class="keyword">module</span> Netplex_main: <code class="code">sig</code> <a href="Netplex_main.html">..</a> <code class="code">end</code></pre><div class="info">
Main program for Netplex servers<br>
</div>
<hr width="100%">
<pre><span id="TYPEcmdline_config"><span class="keyword">type</span> <code class="type"></code>cmdline_config</span> </pre>

<pre><span id="VALargs"><span class="keyword">val</span> args</span> : <code class="type">?defaults:<a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -><br>       unit -> (Arg.key * Arg.spec * Arg.doc) list * <a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a></code></pre><div class="info">
<code class="code">let (opt_list, cmdline_cfg) = args()</code>:
 Returns <code class="code">opt_list</code> for inclusion in the <code class="code">Arg.parse</code> option list.
 The effects made available by the returned <code class="code">cmdline_cfg</code> value.
<p>

 The defaults (unless overridden by <code class="code">defaults</code>): The config file
 is derived from the name of the executable (by appending <code class="code">.conf</code>
 instead of the current extension). There is no config tree.
<p>

<br>
</div>
<div class="param_info"><code class="code">defaults</code> : The default argument values</div>
<pre><span id="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">?config_filename:string -><br>       ?config_tree:<a href="Netplex_types.html#TYPEconfig_tree">Netplex_types.config_tree</a> -><br>       ?pidfile:string option -><br>       ?foreground:bool -> unit -> <a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a></code></pre><div class="info">
Creates the command-line configuration object.
<p>

      By setting <code class="code">config_tree</code> a special configuration can be injected -
      the file <code class="code">config_filename</code> is not loaded in this case (but may
      still appear in error messages)<br>
</div>
<pre><span id="VALmodify"><span class="keyword">val</span> modify</span> : <code class="type">?config_filename:string -><br>       ?config_tree:<a href="Netplex_types.html#TYPEconfig_tree">Netplex_types.config_tree</a> -><br>       ?pidfile:string option -><br>       ?foreground:bool -><br>       <a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -> <a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a></code></pre><div class="info">
Modifies the command-line configuration object<br>
</div>
<pre><span id="VALconfig_filename"><span class="keyword">val</span> config_filename</span> : <code class="type"><a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -> string</code></pre><div class="info">
Returns the filename of the configuration file, or the default
      if it has not been set on the command-line<br>
</div>
<pre><span id="VALconfig_filename_opt"><span class="keyword">val</span> config_filename_opt</span> : <code class="type"><a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -> string option</code></pre><div class="info">
Returns the filename of the configuration file, or <code class="code">None</code> if it
      has not been set on the command-line<br>
</div>
<pre><span id="VALconfig_tree_opt"><span class="keyword">val</span> config_tree_opt</span> : <code class="type"><a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -> <a href="Netplex_types.html#TYPEconfig_tree">Netplex_types.config_tree</a> option</code></pre><div class="info">
Returns the tree of the configuration file, or <code class="code">None</code> if it
      has not been set by <code class="code">create</code> or <code class="code">modify</code>. Note that <code class="code">args</code>
      never sets the config tree.<br>
</div>
<pre><span id="VALpidfile"><span class="keyword">val</span> pidfile</span> : <code class="type"><a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -> string option</code></pre><div class="info">
Returns the location of the PID file (if any)<br>
</div>
<pre><span id="VALforeground"><span class="keyword">val</span> foreground</span> : <code class="type"><a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -> bool</code></pre><div class="info">
Returns whether the daemon runs in the foreground<br>
</div>
<pre><span id="VALstartup"><span class="keyword">val</span> startup</span> : <code class="type">?late_initializer:(<a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a> -><br>                          <a href="Netplex_types.controller-c.html">Netplex_types.controller</a> -> unit) -><br>       ?config_parser:(string -> <a href="Netplex_types.config_file-c.html">Netplex_types.config_file</a>) -><br>       <a href="Netplex_types.parallelizer-c.html">Netplex_types.parallelizer</a> -><br>       <a href="Netplex_types.logger_factory-c.html">Netplex_types.logger_factory</a> list -><br>       <a href="Netplex_types.workload_manager_factory-c.html">Netplex_types.workload_manager_factory</a> list -><br>       <a href="Netplex_types.processor_factory-c.html">Netplex_types.processor_factory</a> list -> <a href="Netplex_main.html#TYPEcmdline_config">cmdline_config</a> -> unit</code></pre><div class="info">
Establishes a configuration and starts the Netplex daemon.
<p>

 If a ready-made configuration tree is included in the passed configuration
 it is taken as the configuration. If otherwise only the name of the
 config file is available, this file is parsed.
 Fails with <code class="code">Netplex_config.Config_error</code> when an error in the
 configuration is detected.
<p>

 The <code class="code">late_initializer</code> is called after the Netplex controller has been
 fully initialized, and before the main event loop is entered. You can
 perform here further initializations, e.g. starting helper threads.
<p>

 The <code class="code">config_parser</code> is by default <code class="code">Netplex_config.read_config_file</code>.
 You can override it by whatever parser you would like to use. The
 parser is only used if a configuration tree is unavailable, and
 the configuration needs to be loaded from a file.
<p>

 As side-effect, the current logger of the <a href="Netlog.html"><code class="code">Netlog</code></a> module is set
 to selected Netplex logger. Note that this setting remains active
 even after <code class="code">startup</code> returns to the caller. Also note that log messages
 submitted via <a href="Netlog.html"><code class="code">Netlog</code></a> appear as from component "netplex.other"
 if they are sent from outside of a container.<br>
</div>
<br>
<h2 id="2_Tutorial">Tutorial</h2>
<p>

 The typical main program for a <code class="code">Netplex</code> server system looks like:
<p>

 <pre class="codepre"><code class="code"> 
   let my_factories = ...

   let start() =
    let opts, cmdconf = Netplex_main.args() in
    Arg.parse 
      opts
      (fun s -&gt; raise(Arg.Bad ("Unknown arg: " ^ s))) 
      "usage: protoserver";
    let par = Netplex_mp.mp() in  (* or Netplex_mt.mt() *)
    Netplex_main.startup
      par
      Netplex_log.logger_factories
      Netplex_workload.workload_manager_factories
      my_factories
      cmdconf

   Sys.set_signal Sys.sigpipe Sys.Signal_ignore;
   start()
 </code></pre>
<p>

 This main program enables:<ul>
<li>The standard command-line arguments <code class="code">-conf</code>, <code class="code">-pid</code> and <code class="code">-fg</code> are 
   understood</li>
<li>The configuration file is parsed</li>
<li>The configuration can refer to all loggers and workload managers
   coming with Netplex</li>
<li>The parallelizer is selected: Here, it is multi-processing
   (Netplex_mp). One could also select multi-threading (Netplex_mt)</li>
<li>The processors defined by <code class="code">my_factories</code> are made available
   for connection processing</li>
</ul>
<br>
</body></html>